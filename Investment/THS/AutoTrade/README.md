# 量化投资同花顺自动化交易系统需求文档

## 1. 概述
### 1.1 项目背景
本项目旨在开发一个基于Python的自动化交易系统，用于实现对同花顺平台上的股票组合和策略进行自动调仓操作。通过定时获取最新的调仓信息，并根据这些信息执行买入或卖出操作，以提高交易效率和准确性。

### 1.2 目标用户
- 量化投资者：希望通过自动化工具优化投资组合管理的专业投资者。
- 同花顺用户：使用同花顺平台进行股票交易的个人投资者。

### 1.3 功能概述
- **自动获取调仓信息**：从同花顺平台获取最新的组合和策略调仓数据。
- **处理调仓信息**：过滤、整理并保存调仓信息到Excel文件中。
- **执行交易操作**：根据调仓信息，自动执行买入或卖出操作。
- **日志记录与通知**：记录所有操作日志，并在关键操作时发送通知。

## 2. 整体架构
### 2.1 系统模块划分
项目主要分为以下几个模块：
- **配置模块**：定义全局配置参数和路径。
- **数据获取模块**：负责从同花顺平台获取最新的调仓信息。
- **数据处理模块**：负责处理和保存调仓信息。
- **交易执行模块**：负责根据调仓信息执行买入或卖出操作。
- **调度模块**：负责定时任务的调度和执行。
- **日志与通知模块**：负责记录操作日志和发送通知。

### 2.2 文件结构
```
others/
└── 量化投资/
    └── THS/
        └── 自动化交易_同花顺/
            ├── 整合/
            │   ├── config/
            │   │   └── settings.py
            │   ├── pages/
            │   │   └── ths_page2.py
            │   ├── scripts/
            │   │   ├── 组合_今天调仓.py
            │   │   ├── 策略_今天调仓.py
            │   │   ├── 数据处理.py
            │   │   └── 自动化交易.py
            │   ├── utils/
            │   │   ├── determine_market.py
            │   │   ├── notification.py
            │   │   ├── scheduler.py
            │   │   └── ths_logger.py
```


## 3. 详细功能描述

### 3.1 配置模块 (`config/settings.py`)
- **功能**：定义全局配置参数和路径，如日志文件路径、Excel文件路径、API URL等。
- **实现方式**：通过Python字典和常量定义配置项。

### 3.2 数据获取模块
#### 3.2.1 组合调仓 (`scripts/组合_今天调仓.py`)
- **功能**：从同花顺平台获取指定组合的最新调仓信息。
- **实现方式**：
  - 使用`requests`库发起HTTP请求，获取组合的调仓数据。
  - 处理返回的数据，提取有用信息。
  - 过滤掉创业板和科创板的股票。
  - 将结果保存到Excel文件中。
  
#### 3.2.2 策略调仓 (`scripts/策略_今天调仓.py`)
- **功能**：从同花顺平台获取指定策略的最新调仓信息。
- **实现方式**：
  - 使用`requests`库发起HTTP请求，获取策略的调仓数据。
  - 处理返回的数据，提取有用信息。
  - 过滤掉创业板和科创板的股票。
  - 将结果保存到Excel文件中。

### 3.3 数据处理模块 (`scripts/数据处理.py`)
- **功能**：读取、处理和保存调仓信息到Excel文件中。
- **实现方式**：
  - 使用`pandas`库读取和写入Excel文件。
  - 提供去重、追加和清空表格的功能。
  - 根据调仓信息执行买入或卖出操作，并记录操作历史。

### 3.4 交易执行模块 (`pages/ths_page2.py`)
- **功能**：根据调仓信息执行买入或卖出操作。
- **实现方式**：
  - 使用`uiautomator2`库控制同花顺APP的UI操作。
  - 定义一系列方法，如点击买入、卖出按钮，输入股票代码和数量，确认交易等。
  - 处理交易过程中的弹窗和异常情况。

### 3.5 调度模块 (`utils/scheduler.py`)
- **功能**：负责定时任务的调度和执行。
- **实现方式**：
  - 使用`schedule`库设置定时任务。
  - 在指定时间段内定期执行调仓信息获取和交易操作。
  - 记录下一次任务的执行时间，并在任务结束时发送通知。

### 3.6 日志与通知模块
#### 3.6.1 日志记录 (`utils/ths_logger.py`)
- **功能**：记录所有操作日志。
- **实现方式**：
  - 使用`logging`库记录日志。
  - 支持控制台输出和文件输出。
  - 使用`colorlog`库为日志添加颜色，便于区分不同级别的日志。

#### 3.6.2 通知 (`utils/notification.py`)
- **功能**：在关键操作时发送通知。
- **实现方式**：
  - 使用`plyer`库发送桌面通知。
  - 可扩展为支持邮件、短信等其他通知方式。

## 4. 关键流程
### 4.1 获取调仓信息
1. **组合调仓**：
   - `组合_今天调仓.py`：从同花顺平台获取指定组合的最新调仓信息。
   - 过滤掉创业板和科创板的股票。
   - 将结果保存到`COMBINATION_TODAY_ADJUSTMENT_FILE`文件中。

2. **策略调仓**：
   - `策略_今天调仓.py`：从同花顺平台获取指定策略的最新调仓信息。
   - 过滤掉创业板和科创板的股票。
   - 将结果保存到`STRATEGY_TODAY_ADJUSTMENT_FILE`文件中。

### 4.2 处理调仓信息
- `数据处理.py`：读取上述两个文件中的调仓信息，处理并保存到Excel文件中。
- 清空昨天的数据，确保只保存今天的调仓信息。

### 4.3 执行交易操作
- `自动化交易.py`：启动同花顺APP，连接设备，初始化页面对象。
- 根据调仓信息执行买入或卖出操作。
- 记录操作历史，并在每次操作后发送通知。

### 4.4 调度与监控
- `scheduler.py`：设置定时任务，在指定时间段内定期执行调仓信息获取和交易操作。
- 记录下一次任务的执行时间，并在任务结束时发送通知。

## 5. 技术选型
- **编程语言**：Python
- **第三方库**：
  - `requests`：用于发起HTTP请求。
  - `pandas`：用于处理和保存Excel文件。
  - `uiautomator2`：用于控制同花顺APP的UI操作。
  - `schedule`：用于设置定时任务。
  - `logging`和`colorlog`：用于日志记录。
  - `plyer`：用于发送桌面通知。

## 6. 未来扩展
- **多平台支持**：扩展支持更多交易平台，如雪球、东方财富等。
- **多种通知方式**：增加邮件、短信等通知方式。
- **更复杂的交易策略**：支持更多复杂的交易策略，如网格交易、趋势跟踪等。
- **性能优化**：优化代码性能，减少响应时间，提高稳定性。

---

以上是详细的项目需求文档，涵盖了项目的整体架构和各个模块的具体实现细节。希望这份文档能够帮助你更好地理解项目的功能和技术实现。
量化投资自动化交易/
├── config/                  # 配置文件
│   └── settings.py          # 全局配置
├── logs/                    # 日志文件
│   ├── ths_auto_trade.log
│   ├── 策略_今天调仓.log
│   └── 组合_今天调仓.log
├── data/                    # 数据文件
│   ├── operation_history.csv
│   ├── 策略今天调仓.xlsx
│   └── 组合今天调仓.xlsx
├── scripts/                 # 脚本文件
│   ├── ths_main.py          # 主程序
│   ├── 策略_今天调仓.py      # 策略调仓脚本
│   └── 组合_今天调仓.py      # 组合调仓脚本
├── utils/                   # 工具类和辅助函数
│   ├── file_monitor.py      # 文件监控工具
│   ├── notification.py      # 通知工具
│   ├── scheduler.py         # 定时任务工具
│   └── ths_logger.py        # 日志工具
├── pages/                   # 页面操作类
│   └── ths_page.py          # 同花顺页面操作类
└── README.md                # 项目说明文档
