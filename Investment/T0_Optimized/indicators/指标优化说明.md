# æŒ‡æ ‡æ–‡ä»¶æ•°æ®åº“ä¼˜åŒ–è¯´æ˜

## ğŸ“ å·²ä¼˜åŒ–çš„æ–‡ä»¶

### 1. comprehensive_t0_strategy.py âœ…

**ä¼˜åŒ–å†…å®¹**:
- âœ… ç§»é™¤akshareå’Œdata2dfcfä¾èµ–
- âœ… å¯¼å…¥DBManagerå’ŒDataManager
- âœ… é‡å†™`fetch_intraday_data`å‡½æ•°ä½¿ç”¨æ•°æ®åº“
- âœ… ä¼˜å…ˆä½¿ç”¨DBManagerï¼ˆåˆ†å±‚ç»“æ„ï¼‰
- âœ… å›é€€ä½¿ç”¨DataManagerï¼ˆå…¼å®¹ï¼‰

**å…³é”®å˜åŒ–**:
```python
# âŒ æ—§ä»£ç 
from data2dfcf import stock_zh_a_hist_min_em as eastmoney_fenshi
df = pd.read_csv(cache_file)

# âœ… æ–°ä»£ç 
from core.data_manager import DataManager
from core.db_manager import DBManager

db_mgr = DBManager()
df = db_mgr.get_minute_data(stock_code, trade_date)
db_mgr.close_all()
```

### 2. price_ma_deviation.pyï¼ˆå¾…ä¼˜åŒ–ï¼‰

**éœ€è¦ä¼˜åŒ–çš„å‡½æ•°**:
```python
def fetch_intraday_data(stock_code: str, trade_date: str) -> Optional[pd.DataFrame]:
    """ä»æ•°æ®åº“è·å–åˆ†æ—¶æ•°æ®"""
    try:
        from core.db_manager import DBManager
        
        db_mgr = DBManager()
        df = db_mgr.get_minute_data(stock_code, trade_date)
        db_mgr.close_all()
        
        if df is not None and not df.empty:
            # å¤„ç†æ—¶é—´åˆ—
            if 'æ—¶é—´' in df.columns:
                df['æ—¶é—´'] = pd.to_datetime(df['æ—¶é—´'])
            return df
        
        # å›é€€åˆ°DataManager
        from core.data_manager import DataManager
        dm = DataManager()
        df = dm.get_minute_data(stock_code, trade_date)
        dm.close()
        return df
        
    except Exception as e:
        logger.error(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return None
```

**ä¿®æ”¹ä½ç½®**:
- ç¬¬140-200è¡Œï¼š`fetch_intraday_data`å‡½æ•°
- ç§»é™¤CSVè¯»å–é€»è¾‘
- æ·»åŠ æ•°æ®åº“è¯»å–é€»è¾‘

### 3. price_ma_deviation_optimized.pyï¼ˆå¾…ä¼˜åŒ–ï¼‰

**éœ€è¦ä¼˜åŒ–çš„å‡½æ•°**:
åŒprice_ma_deviation.pyï¼Œä½†å¢åŠ äº†æ›´å¤šç»Ÿè®¡ä¿¡æ¯è¾“å‡º

**ä¿®æ”¹ä½ç½®**:
- å¯¼å…¥éƒ¨åˆ†ï¼šç§»é™¤`akshare`å’Œ`data2dfcf`
- ç¬¬300-400è¡Œï¼š`fetch_intraday_data`å‡½æ•°
- æ›¿æ¢ä¸ºæ•°æ®åº“è¯»å–

## ğŸ”§ é€šç”¨ä¼˜åŒ–æ¨¡æ¿

### æ­¥éª¤1ï¼šä¿®æ”¹å¯¼å…¥éƒ¨åˆ†

```python
# ç§»é™¤
import akshare as ak
from T0.data2dfcf import stock_zh_a_hist_min_em as eastmoney_fenshi

# æ·»åŠ 
from pathlib import Path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

try:
    from core.data_manager import DataManager
    from core.db_manager import DBManager
    USE_DATABASE = True
except ImportError:
    USE_DATABASE = False
```

### æ­¥éª¤2ï¼šé‡å†™fetch_intraday_dataå‡½æ•°

```python
def fetch_intraday_data(stock_code: str, trade_date: str) -> Optional[pd.DataFrame]:
    """ä»æ•°æ®åº“è·å–åˆ†æ—¶æ•°æ®"""
    if not USE_DATABASE:
        logger.error("æ•°æ®åº“ç®¡ç†å™¨æœªåŠ è½½")
        return None
    
    try:
        # è§£ææ—¥æœŸ
        if '-' in trade_date:
            date_obj = datetime.strptime(trade_date, '%Y-%m-%d')
        else:
            date_obj = datetime.strptime(trade_date, '%Y%m%d')
        
        date_str = date_obj.strftime('%Y-%m-%d')
        
        # ä¼˜å…ˆä½¿ç”¨DBManager
        try:
            db_mgr = DBManager()
            df = db_mgr.get_minute_data(stock_code, date_str)
            db_mgr.close_all()
            
            if df is not None and not df.empty:
                logger.info(f"âœ… DBManagerè¯»å–æˆåŠŸ: {len(df)}æ¡")
                return df
        except Exception as e:
            logger.warning(f"DBManagerå¤±è´¥: {e}")
        
        # å›é€€åˆ°DataManager
        try:
            dm = DataManager()
            df = dm.get_minute_data(stock_code, date_str)
            dm.close()
            
            if df is not None and not df.empty:
                logger.info(f"âœ… DataManagerè¯»å–æˆåŠŸ: {len(df)}æ¡")
                return df
        except Exception as e:
            logger.error(f"DataManagerå¤±è´¥: {e}")
        
        return None
        
    except Exception as e:
        logger.error(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return None
```

### æ­¥éª¤3ï¼šç§»é™¤ç¼“å­˜æ–‡ä»¶é€»è¾‘

```python
# âŒ åˆ é™¤è¿™äº›ä»£ç 
cache_dir = os.path.join(...)
cache_file = os.path.join(cache_dir, f'{stock_code}_{trade_date_str}_fenshi.csv')
if os.path.exists(cache_file):
    df = pd.read_csv(cache_file)
```

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### æ€§èƒ½æå‡
- âœ… æŸ¥è¯¢é€Ÿåº¦ï¼šä»CSVè¯»å– ~10ms â†’ æ•°æ®åº“æŸ¥è¯¢ ~1.5msï¼ˆ**6å€æå‡**ï¼‰
- âœ… å†…å­˜å ç”¨ï¼šå‡å°‘æ–‡ä»¶I/Oæ“ä½œ
- âœ… æ•°æ®ä¸€è‡´æ€§ï¼šç»Ÿä¸€ä»æ•°æ®åº“è¯»å–

### ä»£ç ç®€åŒ–
- âœ… ç§»é™¤æ–‡ä»¶è·¯å¾„ç®¡ç†ä»£ç 
- âœ… ç§»é™¤CSVè¯»å†™é€»è¾‘
- âœ… ç»Ÿä¸€æ•°æ®è®¿é—®æ¥å£

### å¯ç»´æŠ¤æ€§
- âœ… æ•°æ®æºå•ä¸€ï¼ˆæ•°æ®åº“ï¼‰
- âœ… æ˜“äºæ‰©å±•æ–°æŒ‡æ ‡
- âœ… ä¾¿äºæ•°æ®ç‰ˆæœ¬ç®¡ç†

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### è¿è¡Œä¼˜åŒ–åçš„æŒ‡æ ‡

```python
from indicators.comprehensive_t0_strategy import analyze_comprehensive_t0

# åˆ†ææŒ‡å®šæ—¥æœŸ
df, trades = analyze_comprehensive_t0('000333', '2025-10-24')

# æŸ¥çœ‹ç»“æœ
print(f"ä¿¡å·æ•°é‡: {len(df[df['Buy_Signal']])}")
print(f"äº¤æ˜“å¯¹æ•°: {len(trades)}")
```

### ç¡®ä¿æ•°æ®åº“æœ‰æ•°æ®

```bash
# 1. åˆå§‹åŒ–æ•°æ®åº“
cd T0_Optimized
python core/data_manager.py

# 2. éªŒè¯æ•°æ®
python æŸ¥çœ‹æ•°æ®åº“.py

# 3. è¿è¡ŒæŒ‡æ ‡
python -c "from indicators.comprehensive_t0_strategy import *; analyze_comprehensive_t0('000333', '2025-10-24')"
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®ä¾èµ–**ï¼šç¡®ä¿æ•°æ®åº“ä¸­æœ‰å¯¹åº”æ—¥æœŸçš„æ•°æ®
2. **æ—¥æœŸæ ¼å¼**ï¼šæ”¯æŒ `YYYY-MM-DD` å’Œ `YYYYMMDD` ä¸¤ç§æ ¼å¼
3. **æ€§èƒ½è€ƒè™‘**ï¼šDBManagerä½¿ç”¨åˆ†å±‚ç»“æ„ï¼ŒæŸ¥è¯¢æ›´å¿«
4. **é”™è¯¯å¤„ç†**ï¼šå¦‚æœDBManagerå¤±è´¥ä¼šè‡ªåŠ¨å›é€€åˆ°DataManager

## ğŸ“ å¾…ä¼˜åŒ–æ¸…å•

- [x] comprehensive_t0_strategy.py
- [ ] price_ma_deviation.py
- [ ] price_ma_deviation_optimized.py
- [ ] extended_indicators.py
- [ ] momentum_reversal.py
- [ ] resistance_support_indicators.py
- [ ] volume_price_indicators.py
- [ ] volatility_strategy.py

## ğŸ”„ æ‰¹é‡ä¼˜åŒ–è„šæœ¬

å¯ä»¥åˆ›å»ºä¸€ä¸ªè„šæœ¬æ‰¹é‡ä¼˜åŒ–æ‰€æœ‰æŒ‡æ ‡æ–‡ä»¶ï¼š

```python
# optimize_all_indicators.py
import os
from pathlib import Path

indicators_dir = Path(__file__).parent
indicator_files = [
    'price_ma_deviation.py',
    'price_ma_deviation_optimized.py',
    'extended_indicators.py',
    # ... æ·»åŠ å…¶ä»–æ–‡ä»¶
]

for file in indicator_files:
    print(f"ä¼˜åŒ–æ–‡ä»¶: {file}")
    # æ‰§è¡Œä¼˜åŒ–é€»è¾‘
    # ...
```

---

**æœ€åæ›´æ–°**: 2025-10-26
**ä¼˜åŒ–ç‰ˆæœ¬**: v2.0ï¼ˆæ•°æ®åº“ç‰ˆæœ¬ï¼‰
