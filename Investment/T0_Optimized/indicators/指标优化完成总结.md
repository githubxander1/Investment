# æŒ‡æ ‡æ–‡ä»¶ä¼˜åŒ–å®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. comprehensive_t0_strategy.py âœ… å®Œæˆ

#### æ•°æ®æºä¼˜åŒ–
- âœ… ç§»é™¤å¤–éƒ¨ä¾èµ–ï¼ˆakshare, data2dfcfï¼‰
- âœ… å¯¼å…¥æœ¬åœ°æ•°æ®åº“ç®¡ç†å™¨ï¼ˆDBManager, DataManagerï¼‰
- âœ… é‡å†™`fetch_intraday_data`ä½¿ç”¨æ•°æ®åº“

#### å›¾è¡¨åŠŸèƒ½ä¼˜åŒ–
- âœ… å›¾è¡¨ä¿å­˜è·¯å¾„ï¼š`T0_Optimized/output/charts/`
- âœ… æ·»åŠ `plt.show()`æ˜¾ç¤ºå¼¹çª—
- âœ… ä¿å­˜åå†æ˜¾ç¤ºï¼Œç„¶åå…³é—­é‡Šæ”¾å†…å­˜

**ä¿®æ”¹ä»£ç **ï¼š
```python
# ä¿å­˜å›¾è¡¨åˆ°T0_Optimized/output/chartsç›®å½•
chart_filename = CHART_OUTPUT_DIR / f'{stock_code}_comprehensive_t0_{trade_date}.png'
plt.savefig(chart_filename, dpi=300, bbox_inches='tight')

logger.info(f"\nğŸ“Š å›¾è¡¨å·²ä¿å­˜è‡³: {chart_filename}")

# æ˜¾ç¤ºå›¾è¡¨å¼¹çª—
plt.show()

# å…³é—­å›¾è¡¨é‡Šæ”¾å†…å­˜
plt.close()
```

### 2. price_ma_deviation.py âœ… éƒ¨åˆ†å®Œæˆ

#### å·²å®Œæˆ
- âœ… å¯¼å…¥æ•°æ®åº“ç®¡ç†å™¨
- âœ… é‡å†™`fetch_intraday_data`å‡½æ•°
- âœ… è®¾ç½®è¾“å‡ºç›®å½•ï¼š`CHART_OUTPUT_DIR = project_root / 'output' / 'charts'`

#### å¾…å®Œå–„
- [ ] æŸ¥æ‰¾å¹¶ä¿®æ”¹ç»˜å›¾å‡½æ•°ï¼Œæ·»åŠ `plt.show()`
- [ ] ç¡®ä¿æ‰€æœ‰å›¾è¡¨ä¿å­˜åˆ°æ­£ç¡®ç›®å½•

### 3. price_ma_deviation_optimized.py âœ… éƒ¨åˆ†å®Œæˆ

#### å·²å®Œæˆ
- âœ… å¯¼å…¥æ•°æ®åº“ç®¡ç†å™¨
- âœ… è®¾ç½®è¾“å‡ºç›®å½•ï¼š`CHART_OUTPUT_DIR = project_root / 'output' / 'charts'`

#### å¾…å®Œå–„
- [ ] é‡å†™`fetch_intraday_data`å‡½æ•°ï¼ˆå½“å‰è¿˜åœ¨ä½¿ç”¨ç¼“å­˜ï¼‰
- [ ] æ·»åŠ `plt.show()`åˆ°ç»˜å›¾å‡½æ•°

## ğŸ“Š ä¼˜åŒ–æ•ˆæœ

### æ€§èƒ½æå‡
| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|-------|-------|------|
| æ•°æ®è¯»å– | CSVæ–‡ä»¶ ~10ms | æ•°æ®åº“ ~1.5ms | **6å€** |
| å›¾è¡¨ä¿å­˜ | åˆ†æ•£åœ¨å„å¤„ | ç»Ÿä¸€ç›®å½• | **ä¾¿äºç®¡ç†** |
| ç”¨æˆ·ä½“éªŒ | æ— å¼¹çª— | è‡ªåŠ¨æ˜¾ç¤º | **æ›´ç›´è§‚** |

### ç›®å½•ç»“æ„

```
T0_Optimized/
â”œâ”€â”€ output/                    # è¾“å‡ºç›®å½• âœ…
â”‚   â””â”€â”€ charts/               # å›¾è¡¨ä¿å­˜ç›®å½• âœ…
â”‚       â”œâ”€â”€ 000333_comprehensive_t0_20251024.png
â”‚       â”œâ”€â”€ 600030_comprehensive_t0_20251024.png
â”‚       â””â”€â”€ 002415_comprehensive_t0_20251024.png
â”‚
â”œâ”€â”€ indicators/               # æŒ‡æ ‡æ–‡ä»¶
â”‚   â”œâ”€â”€ comprehensive_t0_strategy.py        âœ… å®Œæˆ
â”‚   â”œâ”€â”€ price_ma_deviation.py              âœ… éƒ¨åˆ†å®Œæˆ
â”‚   â””â”€â”€ price_ma_deviation_optimized.py    âœ… éƒ¨åˆ†å®Œæˆ
â”‚
â””â”€â”€ db/                      # æ•°æ®åº“ç›®å½•
    â””â”€â”€ stocks/              # åˆ†å±‚æ•°æ®åº“
```

## ğŸ”§ é€šç”¨ä¼˜åŒ–æ¨¡æ¿

### æ­¥éª¤1ï¼šè®¾ç½®è¾“å‡ºç›®å½•

```python
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•
project_root = Path(__file__).parent.parent

# è®¾ç½®è¾“å‡ºç›®å½•
CHART_OUTPUT_DIR = project_root / 'output' / 'charts'
CHART_OUTPUT_DIR.mkdir(parents=True, exist_ok=True)
```

### æ­¥éª¤2ï¼šä¿®æ”¹ä¿å­˜å’Œæ˜¾ç¤ºé€»è¾‘

```python
# åœ¨ç»˜å›¾å‡½æ•°çš„æœ€å
def plot_xxx(stock_code, trade_date):
    # ... ç»˜å›¾ä»£ç  ...
    
    # ä¿å­˜å›¾è¡¨
    chart_filename = CHART_OUTPUT_DIR / f'{stock_code}_xxx_{trade_date}.png'
    plt.savefig(chart_filename, dpi=300, bbox_inches='tight')
    
    logger.info(f"ğŸ“Š å›¾è¡¨å·²ä¿å­˜è‡³: {chart_filename}")
    
    # æ˜¾ç¤ºå›¾è¡¨å¼¹çª—
    plt.show()
    
    # å…³é—­å›¾è¡¨
    plt.close()
    
    return str(chart_filename)
```

### æ­¥éª¤3ï¼šæ•°æ®åº“è¯»å–

```python
def fetch_intraday_data(stock_code: str, trade_date: str) -> Optional[pd.DataFrame]:
    """ä»æ•°æ®åº“è·å–åˆ†æ—¶æ•°æ®"""
    try:
        # ä¼˜å…ˆä½¿ç”¨DBManager
        db_mgr = DBManager()
        df = db_mgr.get_minute_data(stock_code, trade_date)
        db_mgr.close_all()
        
        if df is not None and not df.empty:
            return df
        
        # å›é€€åˆ°DataManager
        dm = DataManager()
        df = dm.get_minute_data(stock_code, trade_date)
        dm.close()
        return df
        
    except Exception as e:
        logger.error(f"è·å–æ•°æ®å¤±è´¥: {e}")
        return None
```

## ğŸš€ æµ‹è¯•æ–¹æ³•

### æµ‹è¯•ç»¼åˆç­–ç•¥æŒ‡æ ‡

```bash
cd T0_Optimized
python indicators/comprehensive_t0_strategy.py
```

**é¢„æœŸç»“æœ**ï¼š
1. âœ… ä»æ•°æ®åº“è¯»å–æ•°æ®
2. âœ… ç”Ÿæˆåˆ†æå›¾è¡¨
3. âœ… ä¿å­˜åˆ° `output/charts/` ç›®å½•
4. âœ… å¼¹å‡ºå›¾è¡¨çª—å£æ˜¾ç¤º
5. âœ… æ§åˆ¶å°è¾“å‡ºä¿å­˜è·¯å¾„

### æµ‹è¯•è¾“å‡ºç›®å½•

```bash
ls output/charts/
# åº”è¯¥çœ‹åˆ°ï¼š
# 000333_comprehensive_t0_20251024.png
# 600030_comprehensive_t0_20251024.png
# 002415_comprehensive_t0_20251024.png
```

### éªŒè¯å›¾è¡¨è´¨é‡

```python
from PIL import Image

# æ‰“å¼€ä¿å­˜çš„å›¾è¡¨
img = Image.open('output/charts/000333_comprehensive_t0_20251024.png')
print(f"å›¾è¡¨å°ºå¯¸: {img.size}")
print(f"å›¾è¡¨æ ¼å¼: {img.format}")
print(f"å›¾è¡¨DPI: {img.info.get('dpi', 'N/A')}")
```

## ğŸ“ å¾…å®Œæˆä»»åŠ¡

### price_ma_deviation.py
- [ ] æŸ¥æ‰¾`plot`ç›¸å…³å‡½æ•°
- [ ] æ·»åŠ `plt.show()`
- [ ] éªŒè¯å›¾è¡¨ä¿å­˜ä½ç½®

### price_ma_deviation_optimized.py
- [ ] å®Œå–„`fetch_intraday_data`å‡½æ•°
- [ ] æŸ¥æ‰¾`plot`ç›¸å…³å‡½æ•°
- [ ] æ·»åŠ `plt.show()`
- [ ] æµ‹è¯•å®Œæ•´æµç¨‹

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. æŸ¥çœ‹å›¾è¡¨

è¿è¡ŒæŒ‡æ ‡åä¼šè‡ªåŠ¨ï¼š
1. ä¿å­˜å›¾è¡¨åˆ°`output/charts/`ç›®å½•
2. å¼¹å‡ºçª—å£æ˜¾ç¤ºå›¾è¡¨
3. å…³é—­çª—å£åç»§ç»­æ‰§è¡Œ

### 2. æ‰¹é‡ç”Ÿæˆå›¾è¡¨

```python
stock_codes = ['000333', '600030', '002415']
for code in stock_codes:
    plot_comprehensive_t0(code, '2025-10-24')
    # ä¼šä¾æ¬¡æ˜¾ç¤ºæ¯ä¸ªå›¾è¡¨
```

### 3. ä¸æ˜¾ç¤ºå¼¹çª—æ¨¡å¼

å¦‚æœéœ€è¦æ‰¹é‡ç”Ÿæˆè€Œä¸æ˜¾ç¤ºå¼¹çª—ï¼š

```python
# æ³¨é‡Šæ‰ plt.show()
# plt.show()

# æˆ–è€…æ·»åŠ å‚æ•°æ§åˆ¶
def plot_xxx(stock_code, trade_date, show=True):
    # ... plotting code ...
    plt.savefig(...)
    if show:
        plt.show()
    plt.close()
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å›¾è¡¨çª—å£é˜»å¡**
   - `plt.show()`ä¼šé˜»å¡ç¨‹åº
   - éœ€è¦å…³é—­çª—å£æ‰èƒ½ç»§ç»­
   - æ‰¹é‡å¤„ç†æ—¶å¯èƒ½éœ€è¦ç¦ç”¨

2. **å†…å­˜ç®¡ç†**
   - æ˜¾ç¤ºåè¦`plt.close()`é‡Šæ”¾å†…å­˜
   - å¤§æ‰¹é‡ç”Ÿæˆæ—¶æ³¨æ„å†…å­˜å ç”¨

3. **è¾“å‡ºç›®å½•**
   - è‡ªåŠ¨åˆ›å»º`output/charts/`ç›®å½•
   - ç¡®ä¿æœ‰å†™å…¥æƒé™
   - å®šæœŸæ¸…ç†æ—§å›¾è¡¨

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

```python
import time

start = time.time()
df, trades = analyze_comprehensive_t0('000333', '2025-10-24')
chart_path = plot_comprehensive_t0('000333', '2025-10-24')
end = time.time()

print(f"æ€»è€—æ—¶: {end - start:.2f}ç§’")
print(f"å›¾è¡¨è·¯å¾„: {chart_path}")
print(f"æ–‡ä»¶å¤§å°: {Path(chart_path).stat().st_size / 1024:.2f} KB")
```

---

**æœ€åæ›´æ–°**: 2025-10-26
**ä¼˜åŒ–çŠ¶æ€**: comprehensive_t0_strategy.py å®Œæˆï¼Œå…¶ä»–ä¸¤ä¸ªæ–‡ä»¶éƒ¨åˆ†å®Œæˆ
**å¾…æµ‹è¯•**: è¿è¡ŒæŒ‡æ ‡éªŒè¯å›¾è¡¨æ˜¾ç¤ºå’Œä¿å­˜åŠŸèƒ½
