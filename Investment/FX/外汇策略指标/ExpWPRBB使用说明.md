# ExpWPRBB 指标使用说明

## 指标概述

ExpWPRBB 是一个结合威廉变异离散量（WPR）和布林带（BB）的智能交易系统。该系统通过综合分析两种技术指标来生成交易信号，并可选择自动执行交易或仅显示信号供手动参考。

## 指标原理

### 核心组件

1. **威廉变异离散量 (WPR)**
   - 用于判断市场的超买超卖状态
   - 默认参数: 周期32，超买-20，超卖-80

2. **布林带 (BB)**
   - 用于判断价格的相对位置和波动性
   - 默认参数: 周期58，标准差2.0

3. **平均真实波幅 (ATR)**
   - 用于动态计算止损止盈位置
   - 默认参数: 周期64

## 信号生成规则

### 买入信号条件
1. WPR信号: WPR值从下方突破超卖区(-80)
2. 布林带信号: 价格低于布林带下轨和中轨的平均值
3. 两个信号必须同时出现才生成买入信号

### 卖出信号条件
1. WPR信号: WPR值从上方跌破超买区(-20)
2. 布林带信号: 价格高于布林带上轨和中轨的平均值
3. 两个信号必须同时出现才生成卖出信号

## 使用方法

### 1. 仅显示信号模式 (推荐新手)
- 设置 `InpSignalsOnly = true`
- 指标将在图表上显示买卖信号箭头
  - 蓝色箭头(↑): 买入信号
  - 红色箭头(↓): 卖出信号
- WPR信号显示在K线开盘价位置
- 布林带信号显示在布林带轨道位置

### 2. 自动交易模式
- 设置 `InpSignalsOnly = false` (默认值)
- 系统将根据信号自动开仓
- 根据设置自动计算止损和止盈位置
- 系统支持最大持仓数控制，防止过度交易
- 可选择是否自动平掉相反持仓

## 参数详解

### WPR参数
- `InpPeriodWPR`: WPR计算周期 (默认32)
- `InpOverboughtWPR`: 超买水平 (默认-20)
- `InpOversoldWPR`: 超卖水平 (默认-80)

### 布林带参数
- `InpPeriodBB`: 布林带计算周期 (默认58)
- `InpDeviationBB`: 标准差倍数 (默认2.0)
- `InpShiftBB`: 布林带偏移 (默认0)
- `InpPriceBB`: 计算价格类型 (默认收盘价)

### ATR参数
- `InpPeriodATR`: ATR计算周期 (默认64)

### 交易参数
- `InpSignalsOnly`: 仅显示信号，不自动交易 (默认false)
- `InpVolume`: 交易手数 (默认0.1)
- `InpDeviation`: 滑点（点数） (默认10)
- `InpMagic`: 魔术数字 (默认123456)
- `InpStopLoss`: 止损（点数）(默认-1，使用半布林带宽度)
- `InpTakeProfit`: 止盈（点数）(默认-1，使用ATR值)
- `InpSLMltp`: 止损倍数 (默认2.6)
- `InpTPMltp`: 止盈倍数 (默认1.3)
- `InpEnableCloseOpposite`: 是否平掉相反持仓 (默认true)
- `InpMaxPositions`: 最大持仓数 (默认5)
- `InpRiskPercent`: 每次交易风险百分比 (默认1.0%)

## 安卓端安装说明

### 方法一：通过电脑传输
1. 在电脑上编译生成.ex5文件
2. 通过USB数据线连接安卓设备和电脑
3. 将.ex5文件复制到手机存储中的以下路径：
   `/MetaQuotes/MetaTrader 5/MQL5/Experts/`
4. 在安卓MT5中刷新并加载指标

### 方法二：通过MT5内置编辑器
1. 在安卓MT5中打开MQL5编辑器
2. 创建新文件，将源代码粘贴进去
3. 编译生成.ex5文件
4. 在图表上应用该指标

### 证书问题解决方法
如果在安卓端遇到证书导入问题：
1. 进入MT5设置 -> 专家顾问
2. 启用"允许使用未签名的EA和指标"
3. 或者联系指标开发者获取已签名版本

## 交易日志查看

系统会在MT5专家顾问日志中记录详细交易信息：
1. 打开MT5平台
2. 按 Ctrl+R 或 菜单 -> 查看 -> 策略测试器
3. 点击"专家顾问"标签页查看日志信息

日志包含以下信息：
- 系统初始化状态
- 信号生成详情（包含具体指标数值）
- 订单发送和执行情况（包含盈亏信息）
- 错误和警告信息
- 所有日志均包含股票代码标识和时间戳，便于多品种交易时区分和问题追踪

## 最近更新修复

### 编译错误修复
- 修复了LogInfo函数参数不匹配问题，将多个参数拼接为单个字符串
- 修复了HalfSizeBB函数返回值类型错误，移除了不必要的(int)强制类型转换
- 这些修复确保了代码在最新版本MetaEditor中的兼容性和稳定性

### 增强版特性
目前有三个版本的ExpWPRBB指标：
1. **标准版(ExpWPRBB.mq5)** - 基础功能版本
2. **增强版1(ExpWPRBB_增强版1.mq5)** - 添加了一些增强功能
3. **增强版自动交易(ExpWPRBB_增强版_自动交易.mq5)** - 支持全自动交易
4. **增强版手动交易(ExpWPRBB_增强版_手动交易.mq5)** - 仅显示信号，适合手动交易