# 旧系统代码备份

此文件包含原始T0和T0_NewSystem系统的重要代码，作为备份参考。

## T0系统主文件 (T0.py)

```python
# ---------------------- 1. 指标计算（严格还原通达信公式） ----------------------
def calculate_tdx_indicators(df, prev_close, threshold=0.01):
    """
    通达信公式还原：
    H1:=MAX(昨收, 当日最高价);
    L1:=MIN(昨收, 当日最低价);
    P1:=H1-L1;
    阻力:L1+P1*7/8;
    支撑:L1+P1*0.5/8;
    CROSS(支撑,现价) → 支撑上穿现价（画黄色柱）
    LONGCROSS(支撑,现价,2) → 买信号（红三角）
    LONGCROSS(现价,阻力,2) → 卖信号（绿三角）
    """
    # 获取当日最高价和最低价（不是累积最大值/最小值）
    daily_high = df['最高'].max()
    daily_low = df['最低'].min()

    # 计算 H1、L1（昨收 vs 日内高低）
    df['H1'] = np.maximum(prev_close, daily_high)
    df['L1'] = np.minimum(prev_close, daily_low)

    # 支撑、阻力计算（严格按公式 0.5/8 和 7/8）
    df['P1'] = df['H1'] - df['L1']
    df['支撑'] = df['L1'] + df['P1'] * 0.5 / 8
    df['阻力'] = df['L1'] + df['P1'] * 7 / 8

    # 信号计算（严格对齐通达信逻辑）
    # 1. CROSS(支撑, 现价)：支撑上穿现价（前一周期支撑 < 现价，当前支撑 > 现价）= 现价下穿支撑（信号）
    df['cross_support'] = ((df['支撑'].shift(1) < df['收盘'].shift(1)) & (df['支撑'] > df['收盘'])) & \
                          (abs(df['支撑'] - df['收盘']) > threshold)

    # 2. LONGCROSS(支撑, 现价, 2)：连续2周期支撑 < 现价，当前支撑 > 现价（买信号）
    df['longcross_support'] = ((df['支撑'].shift(2) < df['收盘'].shift(2)) & \
                               (df['支撑'].shift(1) < df['收盘'].shift(1)) & \
                               (df['支撑'] > df['收盘'])) & \
                              (abs(df['支撑'] - df['收盘']) > threshold)

    # 3. LONGCROSS(现价, 阻力, 2)：连续2周期现价 < 阻力，当前现价 > 阻力（卖信号）
    df['longcross_resistance'] = ((df['收盘'].shift(2) < df['阻力'].shift(2)) & \
                                  (df['收盘'].shift(1) < df['阻力'].shift(1)) & \
                                  (df['收盘'] > df['阻力']))
    # (abs(df['收盘'] - df['阻力']) > threshold)

    return df
```

## T0_NewSystem系统主文件 (T0_NewSystem/src/main.py)

```python
class T0Strategy:
    """
    T0交易策略主类
    """
    
    def __init__(self, stock_pool=None, refresh_interval=60, save_charts=True, notification_enabled=True):
        """
        初始化T0策略
        
        参数:
        stock_pool: 股票池列表，如果为None则使用默认股票池
        refresh_interval: 数据刷新间隔（秒）
        save_charts: 是否保存图表
        notification_enabled: 是否启用通知
        """
        # 设置股票池
        self.stock_pool = stock_pool if stock_pool else ['600000', '000001', '601318', '000858', '600519']
        
        # 设置参数
        self.refresh_interval = refresh_interval
        self.save_charts = save_charts
        self.notification_enabled = notification_enabled
        
        # 初始化结果记录
        self.results = {}
        
        # 设置中文字体
        plotting.set_chinese_font()
        
        # 创建输出目录
        self.output_dir = os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(__file__))), 'output')
        tools.create_directory(self.output_dir)
        
        print(f"T0策略初始化成功，股票池: {self.stock_pool}")
```

## 重要功能对比

### T0系统特点：
1. 更注重实时监控和通知
2. 包含完整的绘图功能
3. 实现了鼠标悬停显示信息功能
4. 有详细的交易时间检查机制

### T0_NewSystem特点：
1. 更模块化的设计
2. 支持多种技术指标（RSI、MACD、布林带）
3. 更完善的缓存机制
4. 更清晰的代码结构

## 统一后的系统优势

1. **模块化设计**：将功能划分为独立的模块，便于维护和扩展
2. **多指标支持**：不仅支持通达信指标，还支持RSI、MACD、布林带等现代技术指标
3. **兼容性**：保留了两个系统的接口，确保旧代码可以继续运行
4. **完善的缓存机制**：避免重复获取数据，提高效率
5. **多种可视化选项**：支持多种图表类型，便于分析
6. **灵活的通知系统**：可以方便地集成各种通知方式
7. **健壮的错误处理**：包含完整的异常处理机制