N1 := 5;
N2 := 30;
N3 := 20;

MA_N1 := MA(CLOSE, N1);
MA_VOL := MA(VOL, N3);

P_MA_Ratio := MAX(MIN(((CLOSE / MA_N1) - 1) * 100, 20), -20);

buy_thr := -0.3;

Buy_Signal := (P_MA_Ratio <= buy_thr) && (REF(P_MA_Ratio, 1) > buy_thr);

vol_cond := VOL >= 0.7 * MA_VOL;

Final_Buy_Signal := Buy_Signal && vol_cond;
Final_Buy_Signal;