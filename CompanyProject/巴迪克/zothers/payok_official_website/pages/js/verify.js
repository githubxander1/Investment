/*! Verify-v0.1.0 MIT License by*/
!function($,window,document,undefined){var Code=function(ele,opt){this.$element=ele,this.defaults={type:1,figure:100,arith:0,width:"200px",height:"60px",fontSize:"30px",codeLength:6,btnId:"check-btn",ready:function(){},success:function(){},error:function(){}},this.options=$.extend({},this.defaults,opt)},_code_chars=[0,1,2,3,4,5,6,7,8,9,"a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],_code_color1=["#fffff0","#f0ffff","#f0fff0","#fff0f0"],_code_color2=["#FF0033","#006699","#993366","#FF9900","#66CC66","#FF33CC"];Code.prototype={init:function(){var _this=this;this.loadDom(),this.setCode(),this.options.ready(),this.$element[0].onselectstart=document.body.ondrag=function(){return!1},this.$element.find(".verify-code, .verify-change-code").on("click",(function(){_this.setCode()})),this.htmlDoms.code_btn.on("click",(function(){_this.checkCode()}))},loadDom:function(){var panelHtml='<div class="cerify-code-panel"><div class="verify-code"></div><div class="verify-code-area"><div class="verify-input-area"><input type="text" class="varify-input-code" /></div><div class="verify-change-area"><a class="verify-change-code">换一张</a></div></div></div>';this.$element.append(panelHtml),this.htmlDoms={code_btn:$("#"+this.options.btnId),code:this.$element.find(".verify-code"),code_area:this.$element.find(".verify-code-area"),code_input:this.$element.find(".varify-input-code")},this.htmlDoms.code.css({width:this.options.width,height:this.options.height,"line-height":this.options.height,"font-size":this.options.fontSize}),this.htmlDoms.code_area.css({width:this.options.width})},setCode:function(){var color1Num=Math.floor(3*Math.random()),color2Num=Math.floor(5*Math.random());this.htmlDoms.code.css({"background-color":_code_color1[color1Num],color:_code_color2[color2Num]}),this.htmlDoms.code_input.val("");var code="";if(this.code_chose="",1==this.options.type)for(var i=0;i<this.options.codeLength;i++){var charNum=Math.floor(52*Math.random()),tmpStyle=charNum%2==0?"font-style:italic;margin-right: 10px;":"font-weight:bolder;";tmpStyle+=1==Math.floor(2*Math.random())?"font-weight:bolder;":"",this.code_chose+=_code_chars[charNum],code+='<font style="'+tmpStyle+'">'+_code_chars[charNum]+"</font>"}else{var num1=Math.floor(Math.random()*this.options.figure),num2=Math.floor(Math.random()*this.options.figure);if(0==this.options.arith)var tmparith=Math.floor(3*Math.random());switch(tmparith){case 1:this.code_chose=parseInt(num1)+parseInt(num2),code=num1+" + "+num2+" = ?";break;case 2:if(parseInt(num1)<parseInt(num2)){var tmpnum=num1;num1=num2,num2=tmpnum}this.code_chose=parseInt(num1)-parseInt(num2),code=num1+" - "+num2+" = ?";break;default:this.code_chose=parseInt(num1)*parseInt(num2),code=num1+" × "+num2+" = ?"}}this.htmlDoms.code.html(code)},checkCode:function(){if(1==this.options.type){var own_input=this.htmlDoms.code_input.val().toUpperCase();this.code_chose=this.code_chose.toUpperCase()}else var own_input=this.htmlDoms.code_input.val();own_input==this.code_chose?this.options.success():(this.options.error(),this.setCode())}};var Slide=function(ele,opt){this.$element=ele,this.defaults={type:1,vOffset:5,vSpace:5,imgName:["1.jpg","2.jpg","3.jpg"],currTab:"",barText:"Slide right to complete the puzzle",barLockText:"Slide right to unlock",validLoadingText:"Verifying...",loosenVerifyText:"Loosen the validation",successText:"Verify Successfully",imgSize:{width:"400px",height:"200px"},blockSize:{width:"50px",height:"50px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}},this.options=$.extend({},this.defaults,opt)};Slide.prototype={init:function(){var _this=this,startX,startY;this.loadDom(),this.options.ready(),this.$element[0].onselectstart=document.body.ondrag=function(){return!1},this.htmlDoms.move_block.on("touchstart",(function(e){_this.start(e),startX=e.targetTouches[0].pageX,startY=e.targetTouches[0].pageY})),this.htmlDoms.move_block.on("mousedown",(function(e){_this.start(e)})),document.body.addEventListener("touchmove",(function(e){_this.move(e);var moveX=e.targetTouches[0].pageX,moveY=e.targetTouches[0].pageY;Math.abs(moveX-startX)>Math.abs(moveY-startY)&&e.preventDefault()}),{passive:!1}),window.addEventListener("mousemove",(function(e){_this.move(e)})),window.addEventListener("touchend",(function(){_this.end()})),window.addEventListener("mouseup",(function(){_this.end()})),_this.$element.find(".verify-refresh").on("click",(function(){_this.refresh()}))},loadDom:function(){this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var panelHtml="",tmpHtml="";1!=this.options.type&&(panelHtml+='<div class="verify-img-panel"><div  class="verify-refresh"><i class="mdi mdi-refresh"></i></div><div class="verify-gap"></div></div>',tmpHtml='<div  class="verify-sub-block"></div>'),panelHtml+='<div class="verify-bar-area"><span  class="verify-msg" langkey="right_swipe_lock" data-locale="slidetoright">'+this.options.barText+'</span><div class="verify-left-bar"><span  class="verify-msg"></span><div  class="verify-move-block"><i  class="verify-icon mdi mdi-chevron-triple-right"></i>'+tmpHtml+"</div></div></div>",this.$element.append(panelHtml),this.htmlDoms={gap:this.$element.find(".verify-gap"),sub_block:this.$element.find(".verify-sub-block"),img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),move_block:this.$element.find(".verify-move-block"),left_bar:this.$element.find(".verify-left-bar"),msg:this.$element.find(".verify-msg"),icon:this.$element.find(".verify-icon"),refresh:this.$element.find(".verify-refresh")},this.status=!1,this.setSize=this.resetSize(this),this.htmlDoms.gap.css({width:this.options.blockSize.width,height:this.options.blockSize.height}),this.htmlDoms.sub_block.css({width:this.options.blockSize.width,height:this.options.blockSize.height}),this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,background:"url(./public/images/verify/"+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.htmlDoms.bar_area.css({width:this.options.barSize.width,height:this.options.barSize.height,"line-height":this.options.barSize.height}),this.htmlDoms.move_block.css({width:this.options.barSize.height,height:this.options.barSize.height}),this.htmlDoms.left_bar.css({width:this.options.barSize.height,height:this.options.barSize.height}),this.randSet()},start:function(e){this.htmlDoms.msg.text(""),this.htmlDoms.move_block.css("background-color","#727cf5"),this.htmlDoms.left_bar.css("border-color","#727cf5"),this.htmlDoms.icon.css("color","#fff"),e.stopPropagation(),this.status=!0},move:function(e){if(this.status){if(e.touches)var x=e.touches[0].pageX;else var x=e.clientX;var bar_area_left,move_block_left=x-Slide.prototype.getLeft(this.htmlDoms.bar_area[0]);1!=this.options.type?move_block_left>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2&&(move_block_left=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.blockSize.width)/2)-2):move_block_left>=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3?move_block_left=this.htmlDoms.bar_area[0].offsetWidth-parseInt(parseInt(this.options.barSize.height)/2)+3:this.$element.find(".verify-msg:eq(1)").text(""),move_block_left<=0&&(move_block_left=parseInt(parseInt(this.options.blockSize.width)/2)),this.htmlDoms.move_block.css("left",move_block_left-parseInt(parseInt(this.options.blockSize.width)/2)+"px"),this.htmlDoms.left_bar.css("width",move_block_left-parseInt(parseInt(this.options.blockSize.width)/2)+"px")}},end:function(){var _this=this;if(this.status){if(1!=this.options.type){var vOffset=parseInt(this.options.vOffset);parseInt(this.htmlDoms.gap.css("left"))>=parseInt(this.htmlDoms.move_block.css("left"))-vOffset&&parseInt(this.htmlDoms.gap.css("left"))<=parseInt(this.htmlDoms.move_block.css("left"))+vOffset?(this.htmlDoms.move_block.css("background-color","#0acf97"),this.htmlDoms.left_bar.css({"border-color":"#0acf97","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("mdi mdi-chevron-triple-right"),this.htmlDoms.icon.addClass("mdi mdi-check"),this.htmlDoms.refresh.hide(),this.htmlDoms.move_block.unbind("mousedown touchstart"),this.options.success()):(this.htmlDoms.move_block.css("background-color","#fa5c7c"),this.htmlDoms.left_bar.css("border-color","#fa5c7c"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("mdi mdi-chevron-triple-right"),this.htmlDoms.icon.addClass("mdi mdi-lock-outline"),setTimeout((function(){_this.htmlDoms.move_block.animate({left:"0px"},"fast"),_this.htmlDoms.left_bar.animate({width:"40px"},"fast"),_this.htmlDoms.left_bar.css({"border-color":"#ddd"}),_this.htmlDoms.move_block.css("background-color","#fff"),_this.htmlDoms.icon.css("color","#000"),_this.htmlDoms.icon.removeClass("mdi mdi-lock-outline"),_this.htmlDoms.icon.addClass("mdi mdi-chevron-triple-right"),_this.$element.find(".verify-msg:eq(0)").text(this.options.barText),_this.$element.find(".verify-msg:eq(0)").attr("langkey","right_swipe_lock"),_this.options.error()}),400))}else parseInt(this.htmlDoms.move_block.css("left"))>=parseInt(this.setSize.bar_width)-parseInt(this.options.barSize.height)-parseInt(this.options.vOffset)?(this.htmlDoms.move_block.css("background-color","#0acf97"),this.htmlDoms.left_bar.css({color:"#0acf97","border-color":"#0acf97","background-color":"#fff"}),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("mdi mdi-chevron-triple-right"),this.htmlDoms.icon.addClass("mdi mdi-check"),this.htmlDoms.refresh.hide(),this.htmlDoms.move_block.unbind("mousedown"),this.htmlDoms.move_block.unbind("touchstart"),this.$element.find(".verify-msg:eq(1)").text($.i18n.prop(this.options.successText)),this.$element.find(".verify-msg:eq(1)").attr("data-locale","verifysuccess"),this.options.success()):(this.htmlDoms.move_block.css("background-color","#fa5c7c"),this.htmlDoms.left_bar.css("border-color","#fa5c7c"),this.htmlDoms.icon.css("color","#fff"),this.htmlDoms.icon.removeClass("mdi mdi-chevron-triple-right"),this.htmlDoms.icon.addClass("mdi mdi-lock-outline"),setTimeout((function(){_this.htmlDoms.move_block.animate({left:"0px"},"fast"),_this.htmlDoms.left_bar.animate({width:"40px"},"fast"),_this.htmlDoms.left_bar.css({"border-color":"#ddd"}),_this.htmlDoms.move_block.css("background-color","#fff"),_this.htmlDoms.icon.css("color","#000"),_this.htmlDoms.icon.removeClass("mdi mdi-lock-outline"),_this.htmlDoms.icon.addClass("mdi mdi-chevron-triple-right"),_this.$element.find(".verify-msg:eq(0)").text(_this.options.barText),_this.$element.find(".verify-msg:eq(0)").attr("langkey","right_swipe_lock"),_this.options.error()}),400));this.status=!1}},resetSize:function(obj){var img_width,img_height,bar_width,bar_height,parentWidth=obj.$element.parent().width()||$(window).width(),parentHeight=obj.$element.parent().height()||$(window).height();return{img_width:img_width=-1!=obj.options.imgSize.width.indexOf("%")?parseInt(obj.options.imgSize.width)/100*parentWidth+"px":obj.options.imgSize.width,img_height:img_height=-1!=obj.options.imgSize.height.indexOf("%")?parseInt(obj.options.imgSize.height)/100*parentHeight+"px":obj.options.imgSize.height,bar_width:bar_width=-1!=obj.options.barSize.width.indexOf("%")?parseInt(obj.options.barSize.width)/100*parentWidth+"px":obj.options.barSize.width,bar_height:bar_height=-1!=obj.options.barSize.height.indexOf("%")?parseInt(obj.options.barSize.height)/100*parentHeight+"px":obj.options.barSize.height}},randSet:function(){var rand1=Math.floor(9*Math.random()+1),rand2=Math.floor(9*Math.random()+1),top=rand1*parseInt(this.setSize.img_height)/15+.1*parseInt(this.setSize.img_height),left=rand2*parseInt(this.setSize.img_width)/15+.1*parseInt(this.setSize.img_width);this.$element.find(".verify-img-panel").css("margin-bottom",this.options.vSpace+"px"),this.$element.find(".verify-gap").css({top:top,left:left}),this.$element.find(".verify-sub-block").css({top:"-"+(parseInt(this.setSize.img_height)-top+this.options.vSpace+2)+"px","background-image":"url(./public/images/verify/"+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height,"background-position-y":"-"+top+"px","background-position-x":"-"+left+"px"})},refresh:function(){this.randSet(),this.img_rand=Math.floor(Math.random()*this.options.imgName.length),this.$element.find(".verify-img-panel").css({background:"url(./public/images/verify/"+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height}),this.$element.find(".verify-sub-block").css({"background-image":"url(./public/images/verify/"+this.options.imgName[this.img_rand]+")","background-size":this.setSize.img_width+" "+this.setSize.img_height})},getLeft:function(node){var left;return $(node).offset().left}};var Points=function(ele,opt){this.$element=ele,this.defaults={defaultNum:4,checkNum:3,vSpace:5,imgName:["1.jpg","2.jpg","3.jpg"],imgSize:{width:"400px",height:"200px"},barSize:{width:"400px",height:"40px"},ready:function(){},success:function(){},error:function(){}},this.options=$.extend({},this.defaults,opt)};Points.prototype={init:function(){var _this=this;_this.loadDom(),_this.refresh(),_this.options.ready(),this.$element[0].onselectstart=document.body.ondrag=function(){return!1},_this.$element.find(".verify-img-panel canvas").on("click",(function(e){_this.checkPosArr.push(_this.getMousePos(this,e)),_this.num==_this.options.checkNum&&(_this.num=_this.createPoint(_this.getMousePos(this,e)),setTimeout((function(){var flag;0==_this.comparePos(_this.fontPos,_this.checkPosArr)?(_this.options.error(),_this.$element.find(".verify-bar-area").css({color:"#fa5c7c","border-color":"#fa5c7c"}),_this.$element.find(".verify-msg").text("验证失败"),setTimeout((function(){_this.$element.find(".verify-bar-area").css({color:"#000","border-color":"#ddd"}),_this.refresh()}),400)):(_this.$element.find(".verify-bar-area").css({color:"#0acf97","border-color":"#0acf97"}),_this.$element.find(".verify-msg").text($.i18n.prop(_this.options.successText)),_this.$element.find(".verify-msg").attr("data-locale","verifysuccess"),_this.$element.find(".verify-refresh").hide(),_this.$element.find(".verify-img-panel").unbind("click"),_this.options.success())}),400)),_this.num<_this.options.checkNum&&(_this.num=_this.createPoint(_this.getMousePos(this,e)))})),_this.$element.find(".verify-refresh").on("click",(function(){_this.refresh()}))},loadDom:function(){this.fontPos=[],this.checkPosArr=[],this.num=1,this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var panelHtml="",tmpHtml="";this.setSize=Slide.prototype.resetSize(this),panelHtml+='<div class="verify-img-panel"><div  class="verify-refresh" style="z-index:9999"><i class="iconfont icon-refresh"></i></div><canvas width="'+this.setSize.img_width+'" height="'+this.setSize.img_height+'"></canvas></div><div class="verify-bar-area"><span  class="verify-msg"></span></div>',this.$element.append(panelHtml),this.htmlDoms={img_panel:this.$element.find(".verify-img-panel"),bar_area:this.$element.find(".verify-bar-area"),msg:this.$element.find(".verify-msg")},this.htmlDoms.img_panel.css({width:this.setSize.img_width,height:this.setSize.img_height,"background-size":this.setSize.img_width+" "+this.setSize.img_height,"margin-bottom":this.options.vSpace+"px"}),this.htmlDoms.bar_area.css({width:this.options.barSize.width,height:this.options.barSize.height,"line-height":this.options.barSize.height})},drawImg:function(obj,img){var canvas,ctx=this.$element.find("canvas")[0].getContext("2d");ctx.drawImage(img,0,0,parseInt(this.setSize.img_width),parseInt(this.setSize.img_height));for(var fontSizeArr=["italic small-caps bold 20px microsoft yahei","small-caps normal 25px arial","34px microsoft yahei"],fontStr="天地玄黄宇宙洪荒日月盈昃辰宿列张寒来暑往秋收冬藏闰余成岁律吕调阳云腾致雨露结为霜金生丽水玉出昆冈剑号巨阙珠称夜光果珍李柰菜重芥姜海咸河淡鳞潜羽翔龙师火帝鸟官人皇始制文字乃服衣裳推位让国有虞陶唐吊民伐罪周发殷汤坐朝问道垂拱平章爱育黎首臣伏戎羌遐迩体率宾归王",fontChars=[],avg=Math.floor(parseInt(this.setSize.img_width)/(parseInt(this.options.defaultNum)+1)),tmp_index="",color2Num=Math.floor(5*Math.random()),i=1;i<=this.options.defaultNum;i++){if(fontChars[i-1]=this.getChars(fontStr,fontChars),tmp_index=Math.floor(3*Math.random()),ctx.font=fontSizeArr[tmp_index],ctx.fillStyle=_code_color2[color2Num],1==Math.floor(2*Math.random()))var tmp_y=Math.floor(parseInt(this.setSize.img_height)/2)+20*tmp_index+20;else var tmp_y=Math.floor(parseInt(this.setSize.img_height)/2)-20*tmp_index;ctx.fillText(fontChars[i-1],avg*i,tmp_y),this.fontPos[i-1]={char:fontChars[i-1],x:avg*i,y:tmp_y}}for(var i=0;i<this.options.defaultNum-this.options.checkNum;i++)this.shuffle(this.fontPos).pop();for(var msgStr="",i=0;i<this.fontPos.length;i++)msgStr+=this.fontPos[i].char+",";return this.htmlDoms.msg.text("请顺序点击【"+msgStr.substring(0,msgStr.length-1)+"】"),this.fontPos},getMousePos:function(obj,event){var e=event||window.event,scrollX=document.documentElement.scrollLeft||document.body.scrollLeft,scrollY=document.documentElement.scrollTop||document.body.scrollTop,x,y;return{x:e.clientX-($(obj).offset().left-$(window).scrollLeft()),y:e.clientY-($(obj).offset().top-$(window).scrollTop())}},getChars:function(fontStr,fontChars){var tmp_rand=parseInt(Math.floor(Math.random()*fontStr.length));return tmp_rand>0&&(tmp_rand-=1),tmp_char=fontStr.charAt(tmp_rand),-1==$.inArray(tmp_char,fontChars)?tmp_char:Points.prototype.getChars(fontStr,fontChars)},shuffle:function(arr){for(var m=arr.length,i;m;)i=Math.random()*m-->>>0,[arr[m],arr[i]]=[arr[i],arr[m]];return arr},createPoint:function(pos){return this.htmlDoms.img_panel.append('<div class="point-area" style="background-color:#0acf97;color:#fff;z-index:9999;width:30px;height:30px;text-align:center;line-height:30px;border-radius: 50%;position:absolute;top:'+parseInt(pos.y-10)+"px;left:"+parseInt(pos.x-10)+'px;">'+this.num+"</div>"),++this.num},comparePos:function(fontPos,checkPosArr){for(var flag=!0,i=0;i<fontPos.length;i++)if(!(parseInt(checkPosArr[i].x)+40>fontPos[i].x&&parseInt(checkPosArr[i].x)-40<fontPos[i].x&&parseInt(checkPosArr[i].y)+40>fontPos[i].y&&parseInt(checkPosArr[i].y)-40<fontPos[i].y)){flag=!1;break}return flag},refresh:function(){var _this=this;this.$element.find(".point-area").remove(),this.fontPos=[],this.checkPosArr=[],this.num=1,this.img_rand=Math.floor(Math.random()*this.options.imgName.length);var img=new Image;img.src="./public/images/verify/"+this.options.imgName[this.img_rand],$(img).on("load",(function(e){this.fontPos=_this.drawImg(_this,this)}))}},$.fn.codeVerify=function(options,callbacks){var code;new Code(this,options).init()},$.fn.slideVerify=function(options,callbacks){var slide;new Slide(this,options).init()},$.fn.pointsVerify=function(options,callbacks){var points;new Points(this,options).init()}}(jQuery,window,document);